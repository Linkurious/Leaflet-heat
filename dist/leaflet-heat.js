(function(o,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("leaflet")):typeof define=="function"&&define.amd?define(["exports","leaflet"],e):(o=typeof globalThis<"u"?globalThis:o||self,e(o.LeafletHeat={},o.L))})(this,function(o,e){"use strict";var U=Object.defineProperty;var b=(o,e,p)=>e in o?U(o,e,{enumerable:!0,configurable:!0,writable:!0,value:p}):o[e]=p;var u=(o,e,p)=>b(o,typeof e!="symbol"?e+"":e,p);function p(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var z={exports:{}};(function(h){h.exports=f;function f(t){if(!(this instanceof f))return new f(t);this._canvas=t=typeof t=="string"?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._max=1,this._data=[]}f.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,i){i=i===void 0?15:i;var s=this._circle=this._createCanvas(),n=s.getContext("2d"),a=this._r=t+i;return s.width=s.height=a*2,n.shadowOffsetX=n.shadowOffsetY=a*2,n.shadowBlur=i,n.shadowColor="black",n.beginPath(),n.arc(-a,-a,t,0,Math.PI*2,!0),n.closePath(),n.fill(),this},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},gradient:function(t){var i=this._createCanvas(),s=i.getContext("2d"),n=s.createLinearGradient(0,0,0,256);i.width=1,i.height=256;for(var a in t)n.addColorStop(+a,t[a]);return s.fillStyle=n,s.fillRect(0,0,1,256),this._grad=s.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var i=this._ctx;i.clearRect(0,0,this._width,this._height);for(var s=0,n=this._data.length,a;s<n;s++)a=this._data[s],i.globalAlpha=Math.max(a[2]/this._max,t===void 0?.05:t),i.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var v=i.getImageData(0,0,this._width,this._height);return this._colorize(v.data,this._grad),i.putImageData(v,0,0),this},_colorize:function(t,i){for(var s=0,n=t.length,a;s<n;s+=4)a=t[s+3]*4,a&&(t[s]=i[a],t[s+1]=i[a+1],t[s+2]=i[a+2])},_createCanvas:function(){return typeof document<"u"?document.createElement("canvas"):new this._canvas.constructor}}})(z);var C=z.exports;const D=p(C);class M extends e.Layer{constructor(t,i={}){super();u(this,"_latlngs");u(this,"_map");u(this,"_canvas",null);u(this,"_heat",null);u(this,"_frame",null);u(this,"options",{minOpacity:.05,maxZoom:18,radius:25,blur:15,max:1});this._latlngs=t,this._map=null,e.setOptions(this,i)}setLatLngs(t){return this._latlngs=t,this.redraw()}addLatLng(t){return this._latlngs.push(t),this.redraw()}setOptions(t){return e.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()}getBounds(){return e.latLngBounds(this._latlngs)}redraw(){return this._heat&&!this._frame&&this._map&&!this._map._animating&&(this._frame=e.Util.requestAnimFrame(this._redraw,this)),this}onAdd(t){this._map=t,this._canvas||this._initCanvas();const i=this.options.pane?this.getPane():t._panes.overlayPane;return i&&this._canvas&&i.appendChild(this._canvas),t.on("moveend",this._reset,this),t.options.zoomAnimation&&e.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset(),this}onRemove(t){const i=this.options.pane?this.getPane():t._panes.overlayPane;return i&&this._canvas&&i.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this),this}addTo(t){return t.addLayer(this),this}_initCanvas(){const t=this._canvas=e.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),i=e.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);i&&(t.style[i]="50% 50%");const s=this._map.getSize();t.width=s.x,t.height=s.y;const n=this._map.options.zoomAnimation&&e.Browser.any3d;e.DomUtil.addClass(t,"leaflet-zoom-"+(n?"animated":"hide")),this._heat=D(t),this._updateOptions()}_updateOptions(){this._heat&&(this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max))}_reset(){if(!this._heat)return;const t=this._map.containerPointToLayerPoint([0,0]);e.DomUtil.setPosition(this._canvas,t);const i=this._map.getSize();this._heat._width!==i.x&&(this._canvas.width=this._heat._width=i.x),this._heat._height!==i.y&&(this._canvas.height=this._heat._height=i.y),this._redraw()}_redraw(){if(!this._map||!this._heat)return;const t=[],i=this._heat._r,s=this._map.getSize(),n=new e.Bounds(e.point([-i,-i]),s.add([i,i])),a=this.options.max===void 0?1:this.options.max,v=this.options.maxZoom===void 0?this._map.getMaxZoom():this.options.maxZoom,S=1/Math.pow(2,Math.max(0,Math.min(v-this._map.getZoom(),12))),y=i/2,_=[],O=this._map._getMapPanePos(),Z=O.x%y,A=O.y%y;for(let l=0,x=this._latlngs.length;l<x;l++){const c=this._latlngs[l],d=this._map.latLngToContainerPoint(c);if(n.contains(d)){const m=Math.floor((d.x-Z)/y)+2,w=Math.floor((d.y-A)/y)+2;let P;Array.isArray(c)?P=c[2]||1:P=c.alt||1;const g=P*S;_[w]=_[w]||[];const r=_[w][m];r?(r[0]=(r[0]*r[2]+d.x*g)/(r[2]+g),r[1]=(r[1]*r[2]+d.y*g)/(r[2]+g),r[2]+=g):_[w][m]=[d.x,d.y,g]}}for(let l=0,x=_.length;l<x;l++)if(_[l])for(let c=0,d=_[l].length;c<d;c++){const m=_[l][c];m&&t.push([Math.round(m[0]),Math.round(m[1]),Math.min(m[2],a)])}this._heat.data(t).draw(this.options.minOpacity),this._frame=null}_animateZoom(t){if(!this._map||!this._canvas)return;const i=this._map.getZoomScale(t.zoom),s=this._map._getCenterOffset(t.center).multiplyBy(-i).subtract(this._map._getMapPanePos());e.DomUtil.setTransform?e.DomUtil.setTransform(this._canvas,s,i):this._canvas.style[e.DomUtil.TRANSFORM]=e.DomUtil.getTranslateString(s)+" scale("+i+")"}}function T(h,f={}){return new M(h,f)}o.default=M,o.heatLayer=T,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
